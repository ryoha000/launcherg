# Launcherg DL Store Sync - ブラウザ拡張機能

Launchergアプリケーション用のブラウザ拡張機能です。DMM GamesやDLsiteなどのダウンロード版ゲーム販売サイトから購入済みゲーム情報を自動抽出し、Launchergに同期します。

## 📋 目次

- [概要](#概要)
- [対応サイト](#対応サイト)
- [機能](#機能)
- [インストール](#インストール)
- [使用方法](#使用方法)
- [開発者向け情報](#開発者向け情報)
- [設定とカスタマイズ](#設定とカスタマイズ)
- [トラブルシューティング](#トラブルシューティング)
- [プライバシーとセキュリティ](#プライバシーとセキュリティ)

## 🎯 概要

この拡張機能は、Launchergデスクトップアプリケーションと連携して、ブラウザ上でのゲーム購入履歴を自動的に検出・同期します。ユーザーが手動でゲーム情報を入力する手間を省き、購入済みゲームの管理を効率化します。

### 主な特徴

- **🔒 セキュア**: 認証情報は一切保存せず、公開されているゲーム情報のみを抽出
- **⚙️ 設定可能**: JSONベースの抽出ルールで新しいサイト対応が容易
- **🎨 ユーザーフレンドリー**: 直感的なポップアップUIで設定・状況確認が可能
- **🔄 自動同期**: ページ読み込み時の自動検出と手動同期の両方をサポート

## 🌐 対応サイト

### 現在対応済み

| サイト | URL | 抽出可能情報 | 備考 |
|--------|-----|--------------|------|
| **DMM Games** | games.dmm.co.jp | ゲームID, タイトル, 購入URL, サムネイル, 購入日 | 購入済みゲーム一覧ページ |
| **DLsite** | www.dlsite.com | 作品ID, タイトル, 購入URL, サムネイル, 購入日 | 購入済み作品一覧ページ |

### 将来対応予定

- Steam Store
- Epic Games Store
- その他の国内DL販売サイト

## ✨ 機能

### 自動抽出機能

- **ページ検出**: 購入済みゲーム一覧ページの自動認識
- **情報抽出**: ゲームメタデータの自動抽出
- **データ正規化**: サイト固有のデータ形式をLauncherg形式に変換
- **重複回避**: 既に同期済みのゲームをスキップ

### ユーザーインターフェース

- **ポップアップ**: 拡張機能の状態確認と設定変更
- **通知**: 同期結果の表示（成功・エラー）
- **ログ**: 詳細な動作履歴の表示
- **設定画面**: 自動同期の有効/無効、通知設定等

### Launcherg連携

- **Native Messaging**: セキュアなアプリ間通信
- **バッチ同期**: 複数ゲームの一括処理
- **ステータス管理**: 同期状況の詳細追跡

## 📦 インストール

### 前提条件

1. **Launchergアプリケーション** (v1.0.0以降)
2. **対応ブラウザ**:
   - Google Chrome (v88以降)
   - Microsoft Edge (v88以降)
   - その他Chromium系ブラウザ

### インストール手順

#### 方法1: Chrome Web Store（推奨）

1. [Chrome Web Store](https://chrome.google.com/webstore) で「Launcherg DL Store Sync」を検索
2. 「Chromeに追加」をクリック
3. 確認ダイアログで「拡張機能を追加」をクリック
4. Launchergアプリケーションを起動して連携を確認

#### 方法2: 開発版インストール（開発者向け）

1. このリポジトリをクローン
```bash
git clone https://github.com/your-repo/launcherg.git
cd launcherg/browser-extension
```

2. 依存関係をインストール
```bash
npm install
```

3. 拡張機能をビルド
```bash
npm run build
```

4. Chromeで開発者モードを有効化
   - `chrome://extensions/` を開く
   - 右上の「デベロッパーモード」を有効化
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - `dist` フォルダを選択

## 🚀 使用方法

### 基本的な使用手順

1. **Launchergアプリケーションを起動**
   ```
   拡張機能はLaunchergとの通信が必要です
   ```

2. **対応サイトにアクセス**
   - DMM Games: [購入済みゲーム一覧](https://games.dmm.co.jp/library)
   - DLsite: [購入済み作品一覧](https://play.dlsite.com/home/library)

3. **自動同期を確認**
   - ページ読み込み完了後、自動的にゲーム情報を抽出
   - 右上に同期完了通知が表示される

4. **Launchergで確認**
   - アプリケーションの「DL版ゲーム管理」で同期結果を確認

### 手動同期

自動同期が失敗した場合や、特定のタイミングで同期したい場合：

1. **拡張機能アイコンをクリック**
2. **「手動同期」ボタンをクリック**
3. **同期結果を確認**

### 設定変更

拡張機能のポップアップから以下の設定を変更可能：

- **自動同期**: ページ読み込み時の自動同期の有効/無効
- **通知表示**: 同期結果通知の表示/非表示
- **デバッグモード**: 詳細ログの出力
- **同期間隔**: 自動同期の実行間隔（分単位）

## 👨‍💻 開発者向け情報

### プロジェクト構造

```
browser-extension/
├── manifest.json              # 拡張機能の設定
├── src/
│   ├── content-scripts/       # ページ上で動作するスクリプト
│   │   ├── base-extractor.ts  # 汎用抽出システム
│   │   ├── dmm-extractor.ts   # DMM Games専用
│   │   └── dlsite-extractor.ts # DLsite専用
│   ├── background/            # バックグラウンド処理
│   │   └── background.ts      # Native Messaging制御
│   ├── popup/                 # 拡張機能UI
│   │   ├── popup.html
│   │   ├── popup.ts
│   │   └── styles.css
│   └── config/                # 設定ファイル
│       └── extraction-rules.json
├── webpack.config.js          # ビルド設定
├── tsconfig.json             # TypeScript設定
└── package.json              # プロジェクト設定
```

### 開発環境のセットアップ

1. **依存関係インストール**
```bash
npm install
```

2. **開発モードでビルド**
```bash
npm run dev
```

3. **本番ビルド**
```bash
npm run build
```

4. **ファイル監視モード**
```bash
npm run dev
# ファイル変更を監視して自動再ビルド
```

### 技術スタック

- **TypeScript**: 型安全な開発
- **Webpack**: モジュールバンドラー
- **Chrome Extensions API**: ブラウザ拡張機能API
- **Native Messaging API**: デスクトップアプリとの通信

### 抽出ルールの追加

新しいサイトに対応する場合、`src/config/extraction-rules.json` を編集：

```json
{
  "sites": {
    "new_site": {
      "name": "新しいサイト",
      "domain": "example.com",
      "detectionRules": [
        {
          "name": "library_page",
          "selector": ".game-library",
          "required": true
        }
      ],
      "gameExtractionRules": {
        "container": ".game-item",
        "fields": {
          "store_id": {
            "selectors": ["[data-game-id]"],
            "attribute": "data-game-id",
            "required": true
          },
          "title": {
            "selectors": [".game-title"],
            "processor": "text",
            "required": true
          }
        }
      }
    }
  }
}
```

### デバッグ方法

1. **デベロッパーツールを開く**
   - F12キーまたは右クリック → 検証

2. **コンソールでログを確認**
   ```javascript
   // DMM Extractor のログ
   console.log('[DMM Extractor] ...')

   // Background Service のログ
   console.log('[Background] ...')
   ```

3. **拡張機能のバックグラウンドページ**
   - `chrome://extensions/` → 拡張機能の詳細 → 「バックグラウンドページ」

4. **Native Messaging通信の確認**
   - Launchergアプリケーションのログを確認
   - 通信エラーは拡張機能のコンソールに表示

## ⚙️ 設定とカスタマイズ

### 基本設定

拡張機能のポップアップから変更可能な設定：

| 設定項目 | 説明 | デフォルト値 |
|----------|------|--------------|
| 自動同期 | ページ読み込み時の自動同期 | 有効 |
| 通知表示 | 同期結果の通知表示 | 有効 |
| デバッグモード | 詳細ログの出力 | 無効 |
| 同期間隔 | 定期同期の間隔（分） | 30 |

### 高度な設定

#### カスタム抽出ルール

サイトのレイアウト変更に対応するため、カスタム抽出ルールを作成可能：

1. **HTMLサンプルの準備**
   - 対象ページのHTMLを保存
   - ゲーム情報が含まれている部分を特定

2. **セレクターの生成**
   ```javascript
   // デベロッパーツールのコンソールで実行
   const element = document.querySelector('.game-item')
   console.log('ID:', element.id)
   console.log('Classes:', element.className)
   console.log('Data attributes:', [...element.attributes].filter(attr => attr.name.startsWith('data-')))
   ```

3. **ルールの適用**
   - 拡張機能のポップアップから「ルールを管理」
   - 新しいルールを追加・テスト

#### ドメイン管理

特定のドメインでのみ動作するよう制限可能：

```json
{
  "allowed_domains": [
    "games.dmm.co.jp",
    "www.dlsite.com",
    "custom-store.example.com"
  ]
}
```

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. 拡張機能がLaunchergと通信できない

**症状**: 「接続失敗」や「Native Messaging Error」

**解決方法**:
- Launchergアプリケーションが起動しているか確認
- 両方のソフトウェアを最新版に更新
- ブラウザを再起動
- 拡張機能を無効化→有効化

#### 2. ゲーム情報が抽出されない

**症状**: 対象ページでも同期が実行されない

**解決方法**:
- ページが完全に読み込まれるまで待つ
- ブラウザのコンソールでエラーを確認
- デバッグモードを有効にしてログを確認
- 手動同期を試す

#### 3. 一部のゲームだけ同期されない

**症状**: リストの一部のゲームのみが同期される

**解決方法**:
- 該当ゲームのHTML構造を確認
- ErogamescapeIDが正しく関連付けられているか確認
- カスタムルールの追加を検討

#### 4. 同期が重複する

**症状**: 同じゲームが複数回同期される

**解決方法**:
- Launchergアプリケーション側で重複を削除
- 拡張機能の設定をリセット
- ブラウザのキャッシュをクリア

### ログの確認方法

1. **拡張機能のログ**
   ```
   Chrome → 拡張機能 → Launcherg DL Store Sync → 詳細 → バックグラウンドページを調べる
   ```

2. **Content Scriptのログ**
   ```
   対象ページでF12 → Console → フィルターで"[DMM Extractor]"を検索
   ```

3. **Launchergアプリケーションのログ**
   ```
   アプリケーション → ログファイル → DL Store Sync関連のエントリ
   ```

### サポートが必要な場合

問題が解決しない場合は、以下の情報と共にGitHubのIssuesでご報告ください：

- **環境情報**:
  - OS: Windows 10/11
  - ブラウザ: Chrome バージョン
  - Launchergバージョン
  - 拡張機能バージョン

- **再現手順**:
  1. 具体的な操作手順
  2. 期待される結果
  3. 実際の結果

- **ログ情報**:
  - ブラウザのコンソールログ
  - 拡張機能のバックグラウンドログ
  - Launchergアプリケーションのログ

## 🔒 プライバシーとセキュリティ

### データ収集について

この拡張機能は以下の原則に基づいて設計されています：

#### 収集するデータ

- **ゲーム情報のみ**: タイトル、ID、購入URL、サムネイルURL
- **購入履歴**: 購入日（取得可能な場合）
- **使用統計**: 同期回数、エラー統計（個人識別不可）

#### 収集しないデータ

- ❌ **ユーザー認証情報**: パスワード、セッション情報
- ❌ **個人情報**: 氏名、住所、支払い情報
- ❌ **ブラウジング履歴**: 購入ページ以外の閲覧履歴
- ❌ **その他の個人データ**: メール、電話番号等

### セキュリティ対策

#### 通信セキュリティ

- **Native Messaging API**: Chrome標準の安全な通信方式
- **ローカル通信のみ**: データは外部サーバーに送信されない
- **暗号化**: 拡張機能⇔Launcherg間の通信は暗号化

#### アクセス制御

- **最小権限**: 必要最小限のブラウザ権限のみ要求
- **ドメイン制限**: 指定されたサイトでのみ動作
- **ユーザー制御**: いつでも無効化・削除可能

#### データ保存

- **ローカルストレージ**: 設定とログはブラウザ内にのみ保存
- **自動削除**: 拡張機能削除時にすべてのデータが削除
- **暗号化**: 機密性の高いデータは暗号化して保存

### プライバシー設定

ユーザーは以下の設定でプライバシーレベルを調整可能：

- **自動同期の無効化**: 手動同期のみに制限
- **通知の無効化**: 同期結果通知を非表示
- **ログの削除**: 定期的な履歴削除
- **完全削除**: 拡張機能とすべてのデータの削除

### 透明性

- **オープンソース**: 全ソースコードがGitHubで公開
- **監査可能**: セキュリティ専門家による第三者監査を歓迎
- **更新通知**: プライバシーポリシーの変更時は事前通知

---

## 📝 ライセンス

このプロジェクトは [MIT License](../LICENSE) の下で公開されています。

## 🤝 貢献

バグレポート、機能要望、プルリクエストを歓迎しています。詳細は [CONTRIBUTING.md](../CONTRIBUTING.md) をご覧ください。

## 📞 サポート

- **GitHub Issues**: https://github.com/your-repo/launcherg/issues
- **Discord**: https://discord.gg/launcherg
- **Email**: support@launcherg.example.com

---

**Launcherg DL Store Sync** - あなたのゲームライブラリ管理をもっと簡単に。
